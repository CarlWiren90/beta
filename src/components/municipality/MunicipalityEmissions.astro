---
import { type Municipality } from '@/data/municipalityTypes'
import { Card } from '../ui/card'
import MunicipalityGraph from './MunicipalityGraph.svelte'

interface Props {
  municipality: Municipality
}

const { municipality } = Astro.props

console.log('hejsan')
console.log(municipality)

const historicalEmissions = municipality.HistoricalEmission.EmissionPerYear.map(
  (e) => ({
    year: e.Year,
    emission: e.CO2Equivalent,
  }),
)

const approximatedEmissions =
  municipality.ApproximatedHistoricalEmission.EmissionPerYear.map((e) => ({
    year: e.Year,
    emission: e.CO2Equivalent,
  }))

const combinedPastEmissions = [
  ...historicalEmissions.map((e) => ({
    year: e.year,
    emission: e.emission,
    source: 'historical',
  })),
  ...approximatedEmissions.map((e) => ({
    year: e.year,
    emission: e.emission,
    source: 'approximated',
  })),
]

const trendEmissions = municipality.EmissionTrend.TrendPerYear.map((e) => ({
  year: e.Year,
  emission: e.CO2Equivalent,
}))

const budgetEmissions = municipality.Budget.BudgetPerYear.map((e) => ({
  year: e.Year,
  emission: e.CO2Equivalent,
}))
---

<Card class="text-sm" level={1}>
  <h5
    class="text-balance pb-4 pt-2 text-xl leading-none tracking-tight md:pt-0"
  >
    Kommunens utsl√§pp
  </h5>

  <div class="grid gap-4 pt-4">
    <MunicipalityGraph
      client:load
      {combinedPastEmissions}
      {trendEmissions}
      {budgetEmissions}
    />
  </div>
</Card>
