---
import {
  type CompanyData,
  getCompanyName,
  latestYearWithData,
} from '@/data/companyData'
import { buttonVariants } from '../ui/button'
import CompanyEmissions from './CompanyEmissions.astro'
import CompanyInitiatives from './CompanyInitiatives.astro'
import CompanyGoals from './CompanyGoals.astro'
import OtherCompanies from './OtherCompanies.svelte'

interface Props {
  company: CompanyData
  companies: CompanyData[]
}

const { company, companies } = Astro.props

const year = latestYearWithData
const emissions = company.emissions[year]
---

<div class="bg-blue-250 py-2 text-sm text-black">
  <div class="mx-auto max-w-screen-lg px-4 xs:px-8 md:px-12 lg:px-16">
    Denna sida är en betaversion och innehåller delvis AI-genererad data. Om du
    upptäcker felaktigheter i datan, vänligen skicka ett e-postmeddelande till{
      ' '
    }
    <a href="mailto:hej@klimatkollen.se" class="underline"
      >hej@klimatkollen.se</a
    >.
  </div>
</div>

<article class="mx-auto max-w-screen-lg xs:px-4">
  {
    emissions ? (
      <>
        <div class="mt-8 grid gap-8">
          <CompanyEmissions {company} {year} />

          <CompanyInitiatives initiatives={company.initiatives} />

          <CompanyGoals goals={company.goals} />

          <div class="grid place-content-center py-16">
            <OtherCompanies client:idle {companies} />
          </div>
        </div>
      </>
    ) : (
      <div class="mx-auto flex max-w-screen-md flex-col items-start p-4">
        <h1 class="text-4xl font-bold leading-none tracking-tight">
          {getCompanyName(company)}
        </h1>
        <p class="py-4">Data saknas för år {year}.</p>

        <OtherCompanies client:load {companies} />

        <a
          class={buttonVariants({ variant: 'default', class: 'mt-8' })}
          href="https://klimatkollen.se/foretag/utslappen/lista"
        >
          Tillbaka till alla företag
        </a>
      </div>
    )
  }
</article>
