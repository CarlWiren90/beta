---
import Layout from '@/layouts/Layout.astro'
import { type CompanyData, isCompany } from '@/data/companyData'
import Company from '@/components/company.astro'

const { name = '' } = Astro.params

const response = await fetch('https://api.klimatkollen.se/api/companies')
const data = await response.json()
const companies: CompanyData[] = data.filter(isCompany)
const company = companies.find(
  (company) =>
    company.companyName.toLowerCase().replaceAll(' ', '-') ===
    name.toLowerCase(),
)
---

<Layout title="Klimatkollen - få koll på företagens utsläpp">
  <div class="flex flex-wrap gap-2 text-nowrap p-4">
    {
      companies.map((c) => (
        <a
          href={c.companyName.toLocaleLowerCase().replaceAll(' ', '-')}
          class="underline"
        >
          {c.companyName}
        </a>
      ))
    }
  </div>

  {company ? <Company {company} /> : null}
</Layout>
